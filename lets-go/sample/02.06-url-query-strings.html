<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="author" content="Alex Edwards">
	<meta name="copyright" content="Copyright Alex Edwards 2017">
	
	<title> URL Query Strings - Let's Go (Sample)</title>
	
	<link rel="stylesheet" type="text/css" href="assets/css/global.css">
	<link rel="stylesheet" type="text/css" href="assets/css/html.css">
	
	<script>
	    (function(h,o,t,j,a,r){
	        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
	        h._hjSettings={hjid:659192,hjsv:6};
	        a=o.getElementsByTagName('head')[0];
	        r=o.createElement('script');r.async=1;
	        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
	        a.appendChild(r);
	    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
	</script>
	
</head>
<body>
	
	<div class="cta">
		<div class="wrapper">
		You're reading a sample of this book. <a href="https://lets-go.alexedwards.net/">Grab the full version here.</a>
		</div>
	</div>
	
	<header>
		<nav class="wrapper clearfix">
			<div class="breadcrumbs">
				<a href="00.00-lets-go.html">Let's Go</a>
				
					<span class="crumbs">
							
								<span class="separator">&rsaquo;</span> <a href="02.00-foundations.html">Foundations</a>
						 		<span class="separator">&rsaquo;</span>  URL Query Strings
							
					</span>
				
	 		</div>
	 		<div class="menu">
				
				<span>
					<a href="02.05-routing-requests.html" title="2.5.  Routing Requests">Previous</a>
					<span class="separator">&middot;</span>
				</span>
				
				<a href="00.01-contents.html" title="Contents">Contents</a>
				
				<span>
					<span class="separator">&middot;</span>
					<a href="02.07-basic-html-templates.html" title="2.7.  Basic HTML Templates">Next</a>
				</span>
				
			</div>
 		</nav>
	</header>
	<section class="wrapper clearfix">
		<div class="article">
		
		
<h2 id="02.06-url-query-strings">2.6. URL Query Strings</h2>
<p>Let&#39;s add a bit of dynamic behavior to our application, so that the <code>&quot;/snippet&quot;</code> route
accepts a <a href="https://en.wikipedia.org/wiki/Query_string">query string</a> parameter like so:</p>

<table><thead>
<tr>
<th style="text-align: left">URL Path</th>
<th style="text-align: left">Handler</th>
<th style="text-align: left">Action</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">/</td>
<td style="text-align: left">Home</td>
<td style="text-align: left">Display a &quot;Hello from Snippetbox&quot; message</td>
</tr>
<tr>
<td style="text-align: left">/snippet<span>?id=1</span></td>
<td style="text-align: left">ShowSnippet</td>
<td style="text-align: left">Display a specific snippet</td>
</tr>
<tr>
<td style="text-align: left">/snippet/new</td>
<td style="text-align: left">NewSnippet</td>
<td style="text-align: left">Display the new snippet form</td>
</tr>
</tbody></table>
<p>Ultimately, the <code>ShowSnippet</code> function will use the <code>id</code> parameter to determine exactly which text snippet to show the user.</p>
<p>But for now, we&#39;ll just read the value of the <code>id</code> parameter and interpolate it with our placeholder response. To make this work we need our <code>ShowSnippet</code> handler function to do two things:</p>

<ol>
<li><p>First it needs to retrieve the value of the <code>id</code> parameter from the URL query string, which we can do using the <code>r.URL.Query().Get()</code> method.</p></li>
<li><p>Because the <code>id</code> parameter is untrusted user input, we must validate the value to make sure it is sane and sensible. In this case we want to check that it contains a <a href="https://www.mathsisfun.com/definitions/natural-number.html">natural number</a>.</p></li>
</ol>
<div class="group"><div class="codeblock-title">cmd/web/handlers.go</div>
<div class="codeblock go"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span> <span class="c1">// New import</span>
    <span class="s">&quot;net/http&quot;</span>
    <span class="s">&quot;strconv&quot;</span> <span class="c1">// New import</span>
<span class="p">)</span>

<span class="err">···</span>

<span class="kd">func</span> <span class="nx">ShowSnippet</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Extract the value of the id parameter from the query string and try to</span>
    <span class="c1">// convert it to an integer using the strconv.Atoi() function. If it couldn&#39;t</span>
    <span class="c1">// be converted to an integer, or the value is less than 1, we return a 404</span>
    <span class="c1">// Not Found response.</span>
    <span class="nx">id</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nx">Atoi</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Query</span><span class="p">().</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="o">||</span> <span class="nx">id</span> <span class="p">&lt;</span> <span class="mi">1</span> <span class="p">{</span>
        <span class="nx">http</span><span class="p">.</span><span class="nx">NotFound</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">// Use the fmt.Fprintf() function to interpolate the id value with our response</span>
    <span class="c1">// and write it to the http.ResponseWriter.</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&quot;Display a specific snippet (ID %d)...&quot;</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span>
<span class="p">}</span>

<span class="err">···</span>
</pre></div></div><p>I should mention that the <code>r.URL.Query().Get()</code> method always returns a <em>string</em> value for the parameter, or the empty string <code>&quot;&quot;</code> if no matching parameter exists. This is why we are able to pass it directly to the <a href="https://golang.org/pkg/strconv/#Atoi"><code>strconv.Atoi()</code></a> function.</p>
<p>Restart the application, and try visiting a URL like <a href="http://localhost:4000/snippet?id=123"><code>http://localhost:4000/snippet?id=123</code></a>. You should get a response similar to this:</p>
<p><img src="assets/img/02.06-01.png" alt="02.06-01.png"></p>
<p>You might also like to try visiting some URLs which have invalid values for the <code>id</code> parameter, or no parameter at all. For instance:</p>

<ul>
<li><a href="http://localhost:4000/snippet"><code>http://localhost:4000/snippet</code></a></li>
<li><a href="http://localhost:4000/snippet?id=-1"><code>http://localhost:4000/snippet?id=-1</code></a></li>
<li><a href="http://localhost:4000/snippet?id=foo"><code>http://localhost:4000/snippet?id=foo</code></a></li>
</ul>
<p>For all these requests you should receive a <code>404 Not Found</code> response.</p>

<h3>The io.Writer Interface</h3>
<p>The code above introduced another new thing behind-the-scenes. If you take a look at the documentation for the <a href="https://golang.org/pkg/fmt/#Fprintf"><code>fmt.Fprintf()</code></a> function you&#39;ll notice that it takes an <a href="https://golang.org/pkg/io/#Writer"><code>io.Writer</code></a> as the first parameter:</p>
<div class="codeblock go"><pre><span></span><span class="kd">func</span> <span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">,</span> <span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">a</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>
</pre></div><p>But we passed it our <code>http.ResponseWriter</code> object instead, and it worked fine.</p>
<p>We&#39;re able to do this because the <code>io.Writer</code> type is an <dfn>interface</dfn>, and our <code>http.ResponseWriter</code> object <em>satisfies the interface</em> because it has the <code>w.Write()</code> method.</p>
<p>If you&#39;re new to Go the <a href="http://blog.teamtreehouse.com/go-interfaces-awesome">concept of interfaces</a> can be a bit confusing, but in practice, it simply means that anywhere you see an <code>io.Writer</code> parameter it&#39;s OK to use a <code>http.RespsonseWriter</code> too. Whatever is being written will subsequently be sent as the body of the HTTP response.</p>

		
		</div>
	</section>
	<footer>
		
		<span>
			<a href="02.05-routing-requests.html" title="2.5.  Routing Requests">Previous</a>
		</span>
		&middot;
		
		<a href="00.01-contents.html" title="Contents">Contents</a>
		
		&middot;
		<span>
			<a href="02.07-basic-html-templates.html" title="2.7.  Basic HTML Templates">Next</a>
		</span>
		
	</footer>
	
		<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-23830196-1']);
		_gaq.push(['_trackPageview']);
		(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
		</script>
	
</body>
</html>