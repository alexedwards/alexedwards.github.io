<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Alex Edwards">
  <meta name="copyright" content="Copyright Alex Edwards 2017">
  <title>A Basic Web Application - Let's Go (Sample)</title>
  <link rel="stylesheet" type="text/css" href="assets/css/global.css">
  <link rel="stylesheet" type="text/css" href="assets/css/html.css">
  <script>
            (function(h,o,t,j,a,r){
                h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
                h._hjSettings={hjid:659192,hjsv:6};
                a=o.getElementsByTagName('head')[0];
                r=o.createElement('script');r.async=1;
                r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
                a.appendChild(r);
            })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
  </script>
</head>
<body>
  <div class="cta">
    <div class="wrapper">
      You're reading a sample of this book. <a href="https://gumroad.com/l/letsgo">Grab the full version here.</a>
    </div>
  </div>
  <header>
    <nav class="wrapper clearfix">
      <div class="breadcrumbs">
        <a href="00.00-lets-go.html">Let's Go</a> <span class="crumbs"><span class="separator">›</span> <a href="02.00-foundations.html">Foundations</a> <span class="separator">›</span> A Basic Web Application</span>
      </div>
      <div class="menu">
        <span><a href="02.01-workspaces-and-repositories.html" title="2.1. Workspaces and Repositories">Previous</a> <span class="separator">·</span></span> <a href="00.01-contents.html" title="Contents">Contents</a> <span><span class="separator">·</span> <a href="02.03-customizing-responses.html" title="2.3. Customizing Responses">Next</a></span>
      </div>
    </nav>
  </header>
  <section class="wrapper clearfix">
    <article>
      <h2 id="02.02-a-basic-web-application">2.2. A Basic Web Application</h2>
      <p>In this chapter we'll kick off our Snippetbox project and create a super-simple web application with one route, which sends a plain-text <code>"Hello from Snippetbox"</code> response to the user.</p>
      <p>There are three main components to making a web application in Go:</p>
      <ul>
        <li>
          <p>The first thing we need is a <dfn>handler</dfn>. If you're coming from an MVC-background, you can think of handlers as being a bit like controllers. They're responsible for executing your application logic and for writing HTTP response headers and bodies.</p>
        </li>
        <li>
          <p>The second component is a router (or <dfn>serve mux</dfn> in Go terminology). This stores a mapping between the URL patterns for your application and the corresponding handlers. Usually you have one serve mux for your application containing all of your routes.</p>
        </li>
        <li>
          <p>The last thing we need is a running <dfn>web server</dfn>. One of the great things about Go is that you can establish a web server and listen for incoming requests <em>as part of your application itself</em>. You don't need a third-party server like Nginx or Apache.</p>
        </li>
      </ul>
      <p>Let's put these components together in the <code>main.go</code> file to make a working application.</p>
      <div class="group">
        <div class="codeblock-title">
          main.go
        </div>
        <div class="codeblock go">
          <pre><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"log"</span>
    <span class="s">"net/http"</span>
<span class="p">)</span>

<span class="c1">// Define a Home function which writes a plain-text "Hello from Snippetbox"</span>
<span class="c1">// message as the HTTP response body.</span>
<span class="kd">func</span> <span class="nx">Home</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">"Hello from Snippetbox"</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Use the http.NewServeMux() function to initialize a new serve mux. Then use</span>
    <span class="c1">// the mux.HandleFunc() method to register our Home function as the handler for</span>
    <span class="c1">// the "/" URL pattern.</span>
    <span class="nx">mux</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">NewServeMux</span><span class="p">()</span>
    <span class="nx">mux</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="nx">Home</span><span class="p">)</span>

    <span class="c1">// Use the http.ListenAndServe() function to start a new web server. We pass in</span>
    <span class="c1">// two parameters: the TCP network address to listen on (in this case ":4000")</span>
    <span class="c1">// and the serve mux we just created. If ListenAndServe() returns an error we</span>
    <span class="c1">// use the log.Fatal() function to record the error message and exit the program.</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Starting server on :4000"</span><span class="p">)</span>
    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">":4000"</span><span class="p">,</span> <span class="nx">mux</span><span class="p">)</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</pre>
        </div>
      </div>
      <p>When you run this code it should start a web server listening on port <code>4000</code> of your local machine. Each time the server receives a new request it will pass the request on to the serve mux and, in turn, the serve mux will check the URL path and dispatch the request to the matching handler – if one exists.</p>
      <p>Let's give this a try. Save your <code>main.go</code> file and then try running it from your terminal using the <code>go run</code> command.</p>
      <div class="codeblock sh">
        <pre><span class='prompt'>$</span> cd $HOME/go/src/snippetbox.org
<span class='prompt'>$</span> go run main.go
<samp>2017/08/16 17:53:11 Starting server on :4000</samp>
</pre>
      </div>
      <p>While the application is running open up a web browser and try visiting <a href="http://localhost:4000/"><code>http://localhost:4000/</code></a>. If everything has gone to plan you should see a page which looks a bit like this:</p>
      <p><img src="assets/img/02.02-02.png" alt="02.02-02.png"></p>
      <p>Before we continue, I should explain that Go's serve mux treats the pattern <code>"/"</code> like a catch-all. So when we run this application <em>all requests</em> will be dispatched to our <code>Home</code> handler. For instance, you can visit a different URL path like <a href="http://localhost:4000/foo/bar"><code>http://localhost:4000/foo/bar</code></a> and you should receive exactly the same response. We'll talk more about this in the next chapter.</p>
      <p>But before you stop the application, you might want to open a second terminal window and use <a href="https://curl.haxx.se/">curl</a> to view the response headers:</p>
      <div class="codeblock sh">
        <pre><span class='prompt'>$</span> curl -i http://localhost:4000/
<samp>HTTP/1.1 200 OK
Date: Wed, 16 Aug 2017 16:06:59 GMT
Content-Length: 21
Content-Type: text/plain; charset=utf-8

Hello from Snippetbox</samp>
</pre>
      </div>
      <p>Notice how Go has defaulted to sending a <code>200 OK</code> status code, and has automatically set the correct <code>Date</code>, <code>Content-Length</code>, and <code>Content-Type</code> headers?</p>
      <p>If you head back to your original terminal window, you can stop the web application by pressing <code>Ctrl+c</code> on your keyboard.</p>
      <hr>
      <h3>Notes</h3>
      <h4>Network Addresses</h4>
      <p>The TCP network address that you pass to <code>http.ListenAndServe()</code> should be in the format <code>"host:port"</code>. If you omit the host (like we did with <code>":4000"</code>) then the server will listen on all of your computer's available network interfaces. Generally you only need to specify a host in the address if your computer has multiple network interfaces and you want to listen on just one of them.</p>
      <p>Sometimes you might see network addresses written using named ports like <code>":http"</code> or <code>":http-alt"</code> instead of a number. If you use a named port then Go will attempt to look up the relevant port number from your <code>/etc/services</code> file when starting the server, and will return an error if a match can't be found.</p>
    </article>
  </section>
  <footer>
    <span><a href="02.01-workspaces-and-repositories.html" title="2.1. Workspaces and Repositories">Previous</a></span> · <a href="00.01-contents.html" title="Contents">Contents</a> · <span><a href="02.03-customizing-responses.html" title="2.3. Customizing Responses">Next</a></span>
  </footer>
  <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-23830196-1']);
                _gaq.push(['_trackPageview']);
                (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
  </script>
</body>
</html>
