<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="author" content="Alex Edwards">
	<meta name="copyright" content="Copyright Alex Edwards 2017">
	
	<title> Customizing Responses - Let's Go (Sample)</title>
	
	<link rel="stylesheet" type="text/css" href="assets/css/global.css">
	<link rel="stylesheet" type="text/css" href="assets/css/online.css">
</head>
<body>
	
	<div class="cta">
		<div class="wrapper">
		You're reading a sample of this book. <a href="https://gumroad.com/l/letsgo">Grab the full version here.</a>
		</div>
	</div>
	
	<header>
		<nav class="wrapper clearfix">
			<div class="breadcrumbs">
				<a href="00.00-lets-go.html">Let's Go</a>
				<span class="crumbs">
					
						
							<span class="separator">&rsaquo;</span> <a href="02.00-foundations.html">Foundations</a>
					 		<span class="separator">&rsaquo;</span>  Customizing Responses
						
					
				</span>
	 		</div>
	 		<div class="menu">
				
				<span id="previous">
					<a href="02.02-a-basic-web-application.html" title="2.2.  A Basic Web Application">Previous</a>
				<span class="separator">&middot;</span>
				</span>
				
				<a href="00.01-contents.html" title="Contents">Contents</a>
				
				<span id="next">
				<span class="separator">&middot;</span>
					<a href="02.04-project-structure.html" title="2.4.  Project Structure">Next</a>
				</span>
				
			</div>
 		</div>
	</header>
	<section class="wrapper clearfix">
		<article>
		
		
<h2 name="02.03-customizing-responses">2.3. Customizing Responses</h2>

<p>There are a few different ways to make a handler in Go, but the most common is to write your handlers as a function &ndash; just like we have with the <code>Home</code> function in the previous chapter:</p>
<div class="codeblock go"><pre><span class="kd">func</span> <span class="nx">Home</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;Hello from Snippetbox&quot;</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
<p>Notice how this takes exactly two mandatory parameters?</p>

<ul>
<li><p>The <a href="https://golang.org/pkg/net/http/#ResponseWriter"><code>http.ResponseWriter</code></a> parameter provides methods for assembling a HTTP response and sending it to the user. So far we&#39;ve used its <code>w.Write()</code> method to send a byte slice containing <code>&quot;Hello from Snippetbox&quot;</code> as the response body.</p></li>
<li><p>The <a href="https://golang.org/pkg/net/http/#Request"><code>*http.Request</code></a> parameter holds information about the current request, such as the HTTP method and the URL being requested. I&#39;ll show how to use this as we progress through the book.</p></li>
</ul>

<h3>Restricting the Root Path</h3>

<p>As I mentioned in the previous chapter, there&#39;s one problem with our application: All requests that our application receives are being sent the same response, regardless of their URL path.</p>

<p>Let&#39;s fix that and update our <code>Home</code> handler so it sends a <code>404 Not Found</code> response unless the URL path <em>exactly</em> matches <code>&quot;/&quot;</code>. To do this we&#39;ll need to use the <a href="https://golang.org/pkg/net/http/#ResponseWriter"><code>w.WriteHeader()</code></a> method to send the user a <code>404</code> HTTP status code, like so:</p>
<div class="group"><div class="codeblock-title">main.go</div>
<div class="codeblock go"><pre><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;net/http&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">Home</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Use r.URL.Path to check whether the request URL path exactly matches &quot;/&quot;.</span>
    <span class="c1">// If it doesn&#39;t, use the w.WriteHeader() method to send a 404 status code and</span>
    <span class="c1">// the w.Write() method to write a &quot;Not Found&quot; response body. Importantly, we</span>
    <span class="c1">// then return from the function so that the subsequent code is not executed.</span>
    <span class="k">if</span> <span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span> <span class="o">!=</span> <span class="s">&quot;/&quot;</span> <span class="p">{</span>
        <span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
        <span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;Not Found&quot;</span><span class="p">))</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;Hello from Snippetbox&quot;</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">mux</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">NewServeMux</span><span class="p">()</span>
    <span class="nx">mux</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="nx">Home</span><span class="p">)</span>

    <span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Starting server on :4000&quot;</span><span class="p">)</span>
    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:4000&quot;</span><span class="p">,</span> <span class="nx">mux</span><span class="p">)</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</pre></div></div>
<p>Although this change looks pretty straightforward there are a couple of <code>w.WriteHeader()</code> nuances I should explain:</p>

<ul>
<li><p>If you don&#39;t call <code>w.WriteHeader()</code> explicitly then the first call to <code>w.Write()</code>will automatically send a <code>200 OK</code> status code to the user. So you always need to call <code>w.WriteHeader()</code> <em>before</em> any call to <code>w.Write()</code>.</p></li>
<li><p>It&#39;s only possible to call <code>w.WriteHeader()</code> once per request, and once the status code has been sent to the user it can&#39;t be changed. If you try to call it a second time then Go will log an error message.</p></li>
</ul>

<p>Alright, save the file and restart the application. If you make a request to a URL like <a href="http://localhost:4000/foo/bar"><code>http://localhost:4000/foo/bar</code></a> you should now get a <code>404 Not Found</code> response like so:</p>
<div class="codeblock sh"><pre><span class='prompt'>$</span> curl -i http://localhost:4000/foo/bar
<samp>HTTP/1.1 404 Not Found
Date: Wed, 16 Aug 2017 17:15:56 GMT
Content-Length: 9
Content-Type: text/plain; charset=utf-8

Not Found</samp>
</pre></div>
<p>In contrast the root path should continue to work just like before:</p>
<div class="codeblock sh"><pre><span class='prompt'>$</span> curl -i http://localhost:4000/
<samp>HTTP/1.1 200 OK
Date: Wed, 16 Aug 2017 17:15:58 GMT
Content-Length: 21
Content-Type: text/plain; charset=utf-8

Hello from Snippetbox</samp>
</pre></div>
<h3>The NotFound Shortcut</h3>

<p>We can shorten our <code>Home</code> function slightly by using the <a href="https://golang.org/pkg/net/http/#NotFound"><code>http.NotFound()</code></a> helper function. This is essentially a lightweight wrapper around the <code>w.WriteHeader()</code> and <code>w.Write()</code> methods that we&#39;ve just used.</p>
<div class="group"><div class="codeblock-title">main.go</div>
<div class="codeblock go"><pre><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;net/http&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">Home</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span> <span class="o">!=</span> <span class="s">&quot;/&quot;</span> <span class="p">{</span>
        <span class="c1">// Use the http.NotFound() function to send a 404 Not Found response.</span>
        <span class="nx">http</span><span class="p">.</span><span class="nx">NotFound</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;Hello from Snippetbox&quot;</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">mux</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">NewServeMux</span><span class="p">()</span>
    <span class="nx">mux</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="nx">Home</span><span class="p">)</span>

    <span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Starting server on :4000&quot;</span><span class="p">)</span>
    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:4000&quot;</span><span class="p">,</span> <span class="nx">mux</span><span class="p">)</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</pre></div></div>
<p>In terms of functionality this is almost exactly the same. The biggest difference is that we&#39;re now passing <code>http.ResponseWriter</code> to <em>another function</em>, which sends a response to the user for us.</p>

<p>The pattern of passing <code>http.ResponseWriter</code> to other functions is super-common in Go, and something we&#39;ll do a lot throughout this book. In practice, it&#39;s actually quite rare to use the <code>w.Write()</code> and <code>w.WriteHeader()</code> methods directly like we have been so far. But I wanted to introduce them upfront because they underpin the more advanced (and interesting!) ways to send responses.</p>

		
		</article>
	</section>
	<footer>
		
		<span id="previous">
			<a href="02.02-a-basic-web-application.html" title="2.2.  A Basic Web Application">Previous</a>
		</span>
		&middot;
		
		<a href="00.01-contents.html" title="Contents">Contents</a>
		
		&middot;
		<span id="next">
			<a href="02.04-project-structure.html" title="2.4.  Project Structure">Next</a>
		</span>
		
	</footer>
	
		<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-23830196-1']);
		_gaq.push(['_trackPageview']);
		(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
		</script>
	
</body>
</html>