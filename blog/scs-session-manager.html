<!doctype html>
<html lang="en-gb">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Alex Edwards">
    <meta name="copyright" content="Copyright Alex Edwards 2018">
    <meta name="google-site-verification" content="cQSliJDuQ3qRlZyVLmjurqMe4x-Q_SxyvXtpQbWRbeY">
    <title>SCS&#58; A session manager for Go 1.7+</title>
    <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700|Fira+Sans:400,400i,700,800" rel="stylesheet">
    <link rel="stylesheet" href="/static/stylesheets/main.css">
    <style>.async-hide { opacity: 0 !important} </style>
    <script>(function(a,s,y,n,c,h,i,d,e){s.className+=' '+y;h.start=1*new Date;
    h.end=i=function(){s.className=s.className.replace(RegExp(' ?'+y),'')};
    (a[n]=a[n]||[]).hide=h;setTimeout(function(){i();h.end=null},c);h.timeout=c;
    })(window,document.documentElement,'async-hide','dataLayer',4000,
    {'GTM-WXQSQBP':true});</script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-23830196-1', 'auto');
      ga('require', 'GTM-WXQSQBP');
      ga('send', 'pageview');
    </script>
    <link rel="alternate" href="/static/feed.rss" type="application/rss+xml">
    
    <link rel="canonical" href="http://www.alexedwards.net/blog/scs-session-manager"/>
    
  </head>
  <body>
    <header>
      <nav class="wrapper clearfix">
        <div class="breadcrumbs">
          <a href="/">Alex Edwards</a>
          <span class="crumbs">
            
              <span class="separator">&rsaquo;</span>
              <a href="/blog/">Blog</a>
            
            
              <span class="separator">&rsaquo;</span>
              SCS&#58; A session manager for Go 1.7+
            
          </span>
        </div>
        <div class="pages">
          <a href="/blog/">Blog</a>
          <a href="/static/feed.rss">RSS</a>
        </div>
      </nav>
    </header>
    <section class="wrapper clearfix">
      <article class="primary">
	<h1>SCS&#58; A session manager for Go 1.7+</h1>
	<div class="metadata">
		<span class="dates">
			30th August 2016
			
			&middot; <strong>Updated 10th October 2017</strong>
			
		</span>
		
		<span class="tags">
			Filed under: <a href="/blog/category/golang" rel="tag">golang</a><a href="/blog/category/open-source" rel="tag">open-source</a>
		</span>
		
	</div>
	<p>I’ve just released SCS, a session management package for Go 1.7+. You can <a href="https://github.com/alexedwards/scs">view it on Github</a>.</p>

<p>Its design leverages Go’s new <code>context</code> package to automatically load and save session data via middleware.</p>

<p>Importantly, it also provides the security features that you need when using server-side session stores (like straightforward session token regeneration) and supports both absolute and inactivity timeouts. The session data is safe for concurrent use.</p>

<h2>A simple example</h2>

<p>SCS supports a variety of different session stores and is broken up into small single-purpose packages for ease of use.</p>

<table>
<thead>
<tr>
<th>Package</th>
<th></th>
</tr>
</thead>
<tbody>
    <tr><td style="white-space: nowrap"><a href="https://godoc.org/github.com/alexedwards/scs">scs</a></td> <td>Provides session management middleware and helpers for manipulating session data</td> </tr>
    <tr><td style="white-space: nowrap"><a href="https://godoc.org/github.com/alexedwards/scs/stores/boltstore">scs/stores/boltstore</a><td>BoltDB based session store</td></tr>
    <tr><td style="white-space: nowrap"><a href="https://godoc.org/github.com/alexedwards/scs/stores/buntstore">scs/stores/buntstore</a><td>BuntDB based session store</td></tr>
    <tr><td style="white-space: nowrap"><a href="https://godoc.org/github.com/alexedwards/scs/stores/cookiestore">scs/stores/cookiestore</a><td>Encrypted-cookie based session store</td></tr>
    <tr><td style="white-space: nowrap"><a href="https://godoc.org/github.com/alexedwards/scs/stores/dynamostore">scs/stores/dynamostore</a><td>DynamoDB based session store</td></tr><tr><td style="white-space: nowrap"><a href="https://godoc.org/github.com/alexedwards/scs/stores/memstore">scs/stores/memstore</a><td>In-memory session store </td></tr>
    <tr><td style="white-space: nowrap"><a href="https://godoc.org/github.com/alexedwards/scs/stores/mysqlstore">scs/stores/mysqlstore</a><td>MySQL based session store</td></tr>
    <tr><td style="white-space: nowrap"><a href="https://godoc.org/github.com/alexedwards/scs/stores/pgstore">scs/stores/pgstore</a><td>PostgreSQL based session store</td></tr>
    <tr><td style="white-space: nowrap"><a href="https://godoc.org/github.com/alexedwards/scs/stores/qlstore">scs/stores/qlstore</a><td>QL based session store</td></tr>
    <tr><td style="white-space: nowrap"><a href="https://godoc.org/github.com/alexedwards/scs/stores/redisstore">scs/stores/redisstore</a><td>Redis based session store</td></tr>
</tbody>
</table>

<p>To use the in-memory store, for example:</p>

<figure class="file"><figcaption>File: main.go</figcaption><code><pre>
package main

import (
    "io"
    "net/http"
    "time"

    "github.com/alexedwards/scs"
    "github.com/alexedwards/scs/stores/memstore"
)

// Initialize a new encrypted-cookie based session manager and store it in a
// global variable. In a real application, you might inject the session
// manager as a dependency to your handlers instead.
var sessionManager *scs.Manager

func main() {
    // Establish a session manager using the in-memory store and configure
    // it's behaviour.
    sessionManager = scs.NewManager(memstore.New(0))
    sessionManager.Lifetime(3 * time.Hour)
    sessionManager.Persist(true)

    // Set up your HTTP handlers in the normal way.
    mux := http.NewServeMux()
    mux.HandleFunc("/put", putHandler)
    mux.HandleFunc("/get", getHandler)

    // Wrap your handlers with the session manager middleware.
    http.ListenAndServe(":4000", sessionManager.Use(mux))
}

func putHandler(w http.ResponseWriter, r *http.Request) {
    // Load the session data for the current request. Any errors are deferred
    // until you actually use the session data.
    session := sessionManager.Load(r)

    // Use the PutString() method to add a new key and associated string
    // value to the session data. Methods for many other common data types
    // are also provided. The session data is automatically saved.
    err := session.PutString(w, "message", "Hello world!")
    if err != nil {
        http.Error(w, err.Error(), 500)
    }
}

func getHandler(w http.ResponseWriter, r *http.Request) {
    // Load the session data for the current request.
    session := sessionManager.Load(r)

    // Use the GetString() helper to retrieve the string value for the
    // "message" key from the session data. The zero value for a string is
    // returned if the key does not exist.
    message, err := session.GetString("message")
    if err != nil {
        http.Error(w, err.Error(), 500)
    }

    io.WriteString(w, message)
}
</pre></code></figure>

<p>You should be able to verify that the session data is being across requests with curl:</p>

<figure class="shell"><code><pre>
$ curl -i -c cookies localhost:4000/put
<samp>HTTP/1.1 200 OK
Set-Cookie: session=Z37PlmuLf51lFeVIce3Ed7Q4j1Jz_w2w7B2ZrACZ7ds; Path=/; Expires=Tue, 10 Oct 2017 17:02:53 GMT; Max-Age=10800; HttpOnly
Date: Tue, 10 Oct 2017 14:02:52 GMT
Content-Length: 0
Content-Type: text/plain; charset=utf-8</samp>

$ curl -i -b cookies localhost:4000/get
<samp>HTTP/1.1 200 OK
Date: Tue, 10 Oct 2017 14:03:20 GMT
Content-Length: 12
Content-Type: text/plain; charset=utf-8

Hello world!</samp>
</pre></code></figure>

<p>The complete <a href="https://godoc.org/github.com/alexedwards/scs">godocs are here</a>.</p>

<p>I’d love to hear any feedback &ndash; either drop me an email or <a href="https://github.com/alexedwards/scs/issues">open an issue</a> on Github.</p>
	<div class="social">
		<p class="mit"><img src="https://opensource.org/files/osi_symbol.png" height="30px">All code snippets in this post are free to use under the <a href="http://opensource.org/licenses/MIT">MIT Licence</a>.</p>
		<a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-show-count="false">Tweet</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>&nbsp;&nbsp;&nbsp;
		<script src="https://apis.google.com/js/platform.js" async defer></script>
		<g:plusone></g:plusone>
	</div>
</article>
<div class="sidebar">
	<div class="lets-go clearfix">
		<a href="https://lets-go.alexedwards.net/"><img src="/static/images/cover.png"></a>
		<p> <strong>Found this post useful?</strong> My new book has a heap more step-by-step guidance on how to build a fast, secure and maintainable web application with Go. <a href="https://lets-go.alexedwards.net/">Check it out!</a></p>
	</div>
</div>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="/static/javascripts/highlight.pack.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    $('figure code').each(function(i, e) {hljs.highlightBlock(e)});
  });
</script>
    </section>
    <footer>
      <div class="wrapper">
        <div><span class="copyright">&copy;</span> Alex Edwards 2018 &middot; Built using <a href="https://nanoc.ws">Nanoc</a></div>
      </div>
    </footer>
  </body>
</html>
